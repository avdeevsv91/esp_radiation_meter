# ESP Radiation Meter  
Дозиметр для умного дома на ESP8266 и счетчике Гейгера-Мюллера СБМ-20. Более подробный обзор смотрите в видео по ссылке https://www.youtube.com/watch?v=oDm4vXUvszQ

## Сборка устройства
На основе файла [hardware.lay6](https://github.com/avdeevsv91/esp_radiation_meter/raw/master/hardware/hardware.lay6) изготавливается печатная плата, на которую впоследствии запаиваются компоненты, согласно [схемы](https://github.com/avdeevsv91/esp_radiation_meter/raw/master/hardware/scheme_detector_block.jpg). Ссылки на покупку необходимых деталей представлены ниже:  

Микроконтроллер ESP-12F http://ali.pub/3srapr  
USB модуль CP2102 http://ali.pub/3srari  
Стабилизаторы LM1117-3.3 http://ali.pub/3sraso  
Транзисторы IRLML6346TRPBF http://ali.pub/3sratn  
Транзисторы BC847 http://ali.pub/3sravl  
Диоды 4007 http://ali.pub/3srawk  
Дроссели 10 мГн http://ali.pub/3sraxx  
Крепления для трубки 6x30мм http://ali.pub/3srayp  
Высоковольтные конденсаторы http://ali.pub/3srb02  
Пленочные конденсаторы http://ali.pub/3srb3k  
Танталовые конденсаторы http://ali.pub/3srb63  
Керамические конденсаторы http://ali.pub/3srb7u  
SMD резисторы http://ali.pub/3srb90

Трансформатор изготавливается на основе дросселя "гантельки" на 10 мГн путем намотки поверх него четырех витков изолированной жилы от кабеля витой пары.

### Настройка
Правильно собранное устройство не нуждается в настройке и после прошивки сразу готово к работе. Тем не менее, перед сборкой прошивки, можно отредактировать некоторые параметры:

```#define PUMPING_PIN    4   // Номер пина генератора накачки```  
```#define PUMPING_PULSE  50  // Длина импульса накачки```  
```#define PUMPING_FREQ   5   // Частота генератора накачки```  
```#define PUMPING_ADC    450 // Максимальное напряжение делителя АЦП```  
```#define PUMPING_POWER  400 // Напряжение питания счетчика```  
``` ```  
```#define SENSOR_PIN    5  // Номер пина, к которому подсоединен датчик```  
```#define SENSOR_TYPE   1  // Тип датчика (СБМ-20/СТС-5/BOI-33 = 1, СБМ-19/СТС-6 = 2)```  
```#define SENSOR_NUM    1  // Количество установленных датчиков (параллельное подключение)```  
```#define SENSOR_TIME   36 // Время для замера в секундах```  
```#define SENSOR_SUM    10 // Количество замеров для усреднения```  

### Прошивка
Для сборки прошивки используется сервис [WiFi-IoT](https://wifi-iot.com/). В конструкторе необходимо выбрать SDK версии 1.3.0, отметить модули "Настройки по умолчанию" (указываются параметры подключения к вашей точке доступа), "MQTT клиент", "UART bridge" и "Конструктор кода" (вставляем код прошивки из файла [firmware.c](https://github.com/avdeevsv91/esp_radiation_meter/raw/master/firmware/firmware.c)) и скомпилировать бинарник.

Скачиваем результат в виде одного файла и прошиваем (я использовал [NodeMCU Flasher](https://github.com/nodemcu/nodemcu-flasher)) с начального адреса 0x00000. Вход в режим программирования осуществляется одновременным нажатием двух кнопок на печатной плате. Чтобы микроконтроллер активировал работу со всеми требуемыми модулями, необходимо зарегистрировать для него PRO-лицензию. Более подробно об этом процессе можно прочитать в официальной [инструкции](https://wifi-iot.com/p/wiki/131/ru/) сервиса.  

### Программное обеспечение
В рамках данного проекта была написана утилита [Radiation Meter Software](https://github.com/avdeevsv91/radiation_meter_software), основная задача которой сводится к уведомлению пользователя при привышении заданных границ радиационного фона.
